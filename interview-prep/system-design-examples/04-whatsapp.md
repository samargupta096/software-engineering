[ğŸ  Home](../README.md) | [â¬…ï¸ 03 Uber](./03-uber.md) | [â¡ï¸ 05 Netflix Interview](./05-netflix/01-system-design-interview.md)

# ğŸ’¬ WhatsApp System Design

> Design a messaging system for 2 billion users

---

## âœ… Functional Requirements

| Feature | Description |
|---------|-------------|
| **1:1 Chat** | Send/receive messages |
| **Group Chat** | Up to 256 members |
| **Media Sharing** | Images, videos, documents |
| **Read Receipts** | Delivered, seen status |
| **Online Status** | Last seen, typing indicator |

---

## ğŸ“Š Scale Estimation

- **Users**: 2 billion
- **DAU**: 500 million
- **Messages/day**: 100 billion
- **Message size**: ~100 bytes average

---

## ğŸ—ï¸ High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           CLIENTS                                   â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚    â”‚  User A  â”‚                              â”‚  User B  â”‚          â”‚
â”‚    â”‚  (App)   â”‚                              â”‚  (App)   â”‚          â”‚
â”‚    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                              â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                                          â”‚
          â–¼                                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       CONNECTION LAYER                              â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚    â”‚  WebSocket     â”‚                  â”‚  WebSocket     â”‚          â”‚
â”‚    â”‚  Server 1      â”‚                  â”‚  Server 2      â”‚          â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                                    â”‚
             â–¼                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         SERVICES                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Message    â”‚  â”‚   Presence   â”‚  â”‚    Group     â”‚  â”‚  Media  â”‚ â”‚
â”‚  â”‚   Service    â”‚  â”‚   Service    â”‚  â”‚   Service    â”‚  â”‚ Service â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”˜
          â”‚                 â”‚                 â”‚               â”‚
          â–¼                 â–¼                 â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         DATA LAYER                                  â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚    â”‚  Cassandra   â”‚   â”‚    Redis     â”‚   â”‚      S3      â”‚          â”‚
â”‚    â”‚  (Messages)  â”‚   â”‚  (Sessions)  â”‚   â”‚   (Media)    â”‚          â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¨ Message Flow

### Online User (Real-time Delivery)

```
User A                WebSocket 1       Message Service      WebSocket 2       User B
  â”‚                       â”‚                   â”‚                   â”‚               â”‚
  â”‚â”€â”€â”€â”€ Send message â”€â”€â”€â”€â–¶â”‚                   â”‚                   â”‚               â”‚
  â”‚                       â”‚â”€â”€ Store & Route â”€â–¶â”‚                   â”‚               â”‚
  â”‚                       â”‚                   â”‚â”€â”€ Store in DB â”€â”€â”€â–¶â”‚               â”‚
  â”‚                       â”‚                   â”‚                   â”‚               â”‚
  â”‚                       â”‚                   â”‚â”€â”€ Forward â”€â”€â”€â”€â”€â”€â”€â–¶â”‚               â”‚
  â”‚                       â”‚                   â”‚                   â”‚â”€â”€Deliverâ”€â”€â–¶   â”‚
  â”‚                       â”‚                   â”‚                   â”‚               â”‚
  â”‚                       â”‚                   â”‚                   â”‚â—€â”€â”€ ACK â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                       â”‚                   â”‚â—€â”€ Update status â”€â”€â”‚               â”‚
  â”‚                       â”‚â—€â”€â”€ Delivered â”€â”€â”€â”€â”‚                   â”‚               â”‚
  â”‚â—€â”€â”€â”€â”€ âœ“âœ“ Delivered â”€â”€â”€â”€â”‚                   â”‚                   â”‚               â”‚
  â”‚                       â”‚                   â”‚                   â”‚               â”‚
```

### Offline User (Store & Forward)

```
User A              Message Service         Database           User B (Offline)
  â”‚                       â”‚                     â”‚                     â”‚
  â”‚â”€â”€â”€ Send message â”€â”€â”€â”€â”€â–¶â”‚                     â”‚                     â”‚
  â”‚                       â”‚â”€â”€â”€ Store msg â”€â”€â”€â”€â”€â”€â–¶â”‚                     â”‚
  â”‚                       â”‚                     â”‚     [OFFLINE]       â”‚
  â”‚â—€â”€â”€â”€â”€â”€ âœ“ Sent â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                     â”‚                     â”‚
  â”‚                       â”‚                     â”‚                     â”‚
  â”‚                       â”‚                     â”‚     [COMES ONLINE]  â”‚
  â”‚                       â”‚â—€â”€â”€â”€â”€ Sync request â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                       â”‚â”€â”€â”€ Get pending â”€â”€â”€â”€â–¶â”‚                     â”‚
  â”‚                       â”‚â—€â”€â”€ [msg1,msg2...] â”€â”€â”‚                     â”‚
  â”‚                       â”‚â”€â”€â”€â”€â”€â”€â”€â”€ Deliver â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
  â”‚                       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€ ACK all â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚â—€â”€â”€â”€â”€ âœ“âœ“ Delivered â”€â”€â”€â”€â”‚                     â”‚                     â”‚
```

---

## ğŸ’¾ Data Storage

### Message Schema (Cassandra)
```sql
CREATE TABLE messages (
    chat_id UUID,
    message_id TIMEUUID,
    sender_id UUID,
    content BLOB,  -- Encrypted
    media_url TEXT,
    status TEXT,   -- sent, delivered, read
    created_at TIMESTAMP,
    PRIMARY KEY (chat_id, message_id)
) WITH CLUSTERING ORDER BY (message_id DESC);
```

### Why Cassandra?
- Write-heavy workload (100B messages/day)
- Horizontal scaling
- Time-series data (messages ordered by time)
- High availability

### Connection Mapping (Redis)
```
user:{user_id}:connection â†’ ws_server_1
user:{user_id}:status â†’ "online" | "last_seen:timestamp"
```

---

## ğŸ” End-to-End Encryption

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       USER A        â”‚                      â”‚       USER B        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Private Key A â”‚  â”‚                      â”‚  â”‚ Private Key B â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”  â”‚                      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Public Key A  â”‚â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â–¶â”‚ Public Key B  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                                            â”‚
          â”‚  1. A encrypts with B's public key         â”‚
          â”‚                                            â”‚
          â–¼                                            â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚
   â”‚  Encrypted  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶
   â”‚   Message   â”‚     [Server cannot read this]       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚
                                                       â–¼
                                           2. B decrypts with
                                              B's private key
                                                       â”‚
                                                       â–¼
                                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                               â”‚ Plain Text  â”‚
                                               â”‚   Message   â”‚
                                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Signal Protocol:**
- Double Ratchet Algorithm
- Pre-keys for offline messaging
- Server cannot read messages

---

## ğŸ‘¥ Group Messaging

```
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚       SENDER          â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚    Message Service    â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚              â”‚              â”‚
                     â–¼              â–¼              â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Member 1 â”‚  â”‚ Member 2 â”‚   â”‚ Member N â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     
                     Fan-out: Send to ALL members
```

### Group Metadata
```json
{
  "group_id": "uuid",
  "name": "Family Group",
  "members": ["user1", "user2", "user3"],
  "admins": ["user1"],
  "created_at": "2026-01-01"
}
```

---

## ğŸ“± Presence & Typing Indicators

### Last Seen

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User opens   â”‚â”€â”€â”€â”€â”€â–¶â”‚  WebSocket   â”‚â”€â”€â”€â”€â”€â–¶â”‚    Redis     â”‚
â”‚   app        â”‚      â”‚   Server     â”‚      â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                    â”‚
                                                    â–¼
                                            user:123:last_seen
                                            = "2026-01-26 16:30"
```

### Typing Indicator

```
User A                 WebSocket                User B
  â”‚                       â”‚                        â”‚
  â”‚â”€â”€â”€ typing:start â”€â”€â”€â”€â”€â–¶â”‚                        â”‚
  â”‚                       â”‚â”€â”€ "A is typing..." â”€â”€â”€â–¶â”‚
  â”‚                       â”‚                        â”‚ [Shows indicator]
  â”‚â”€â”€â”€ typing:stop â”€â”€â”€â”€â”€â”€â–¶â”‚                        â”‚
  â”‚      (or send msg)    â”‚â”€â”€ Clear indicator â”€â”€â”€â”€â–¶â”‚
  â”‚                       â”‚                        â”‚ [Hides indicator]
```

**Optimization:** Throttle typing events (send every 2 seconds max)

---

## âš¡ Key Optimizations

| Optimization | Purpose |
|-------------|---------|
| **Persistent Connections** | Reduce connection overhead |
| **Message Compression** | Reduce bandwidth |
| **Local DB (SQLite)** | Offline access, fast loading |
| **Media CDN** | Fast media delivery |
| **Message Batching** | Reduce network calls |

---

## ğŸŒ Real-World Examples

### Example 1: Sending a Photo

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User A   â”‚     â”‚  Media   â”‚     â”‚   CDN    â”‚     â”‚   User B â”‚
â”‚ (Sender) â”‚     â”‚ Service  â”‚     â”‚   (S3)   â”‚     â”‚(Receiver)â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                â”‚                â”‚                â”‚
     â”‚â”€â”€ Upload â”€â”€â”€â”€â”€â–¶â”‚                â”‚                â”‚
     â”‚   photo        â”‚â”€â”€ Store â”€â”€â”€â”€â”€â”€â–¶â”‚                â”‚
     â”‚                â”‚â—€â”€â”€ URL â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚
     â”‚â—€â”€ Media URL â”€â”€â”€â”‚                â”‚                â”‚
     â”‚                â”‚                â”‚                â”‚
     â”‚â”€â”€â”€â”€ Send message with URL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
     â”‚                â”‚                â”‚                â”‚
     â”‚                â”‚                â”‚â—€â”€â”€ Download â”€â”€â”€â”‚
     â”‚                â”‚                â”‚â”€â”€â”€ Photo â”€â”€â”€â”€â”€â–¶â”‚
```

**Real Use Case:** 
- Sending wedding photos to family group
- Photo uploaded once to S3
- All 50 group members download from CDN (not sender's device)

---

### Example 2: Business WhatsApp - Order Notification

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Zomato     â”‚     â”‚  WhatsApp    â”‚     â”‚   Customer   â”‚
â”‚   Backend    â”‚     â”‚ Business API â”‚     â”‚    Phone     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                    â”‚                    â”‚
       â”‚â”€â”€ Order placed â”€â”€â”€â–¶â”‚                    â”‚
       â”‚   template msg     â”‚                    â”‚
       â”‚                    â”‚â”€â”€ Send message â”€â”€â”€â–¶â”‚
       â”‚                    â”‚                    â”‚ "Order #1234 
       â”‚                    â”‚                    â”‚  confirmed!"
       â”‚                    â”‚â—€â”€â”€â”€â”€ Delivered â”€â”€â”€â”€â”‚
       â”‚â—€â”€â”€ Webhook: â”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚
       â”‚    delivered       â”‚                    â”‚
```

**Real Use Case:**
- Swiggy/Zomato order confirmation
- Flipkart delivery updates  
- Bank OTP messages
- Uber ride confirmations

---

### Example 3: Group Video Call Setup

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User A  â”‚  â”‚ User B  â”‚  â”‚ User C  â”‚     â”‚ Signaling   â”‚
â”‚(Caller) â”‚  â”‚         â”‚  â”‚         â”‚     â”‚   Server    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
     â”‚            â”‚            â”‚                  â”‚
     â”‚â”€â”€ Start call â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
     â”‚            â”‚            â”‚                  â”‚
     â”‚            â”‚â—€â”€â”€â”€â”€ Incoming call â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚            â”‚            â”‚â—€â”€â”€ Incoming call â”€â”‚
     â”‚            â”‚            â”‚                  â”‚
     â”‚            â”‚â”€â”€ Accept â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
     â”‚            â”‚            â”‚â”€â”€ Accept â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
     â”‚            â”‚            â”‚                  â”‚
     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ P2P Connection Setup â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
     â”‚            â”‚            â”‚                  â”‚
     â”‚â—€â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¡
     â”‚     Direct video/audio stream (WebRTC)     â”‚
     â”‚â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–¶â”‚
```

**Real Use Case:**
- Family group calling during festivals
- Team standup calls
- After initial setup, data flows P2P (not through servers)

---

### Example 4: Message Status Updates

```
Status      Symbol     Meaning
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Sending     â³         Message in queue
Sent        âœ“          Reached server
Delivered   âœ“âœ“         Reached recipient's device
Read        âœ“âœ“ (blue)  Recipient opened chat


Timeline:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  0ms        50ms       200ms        2s          5s          â”‚
â”‚   â”‚          â”‚           â”‚          â”‚           â”‚           â”‚
â”‚   â–¼          â–¼           â–¼          â–¼           â–¼           â”‚
â”‚  â³â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶âœ“â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶âœ“âœ“â”€â”€â”€â”€â”€â”€â”€â”€â–¶âœ“âœ“(blue)                â”‚
â”‚ Sending    Sent      Delivered    Read                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“š Key Takeaways

- WebSocket for real-time bidirectional communication
- Cassandra for high-write message storage
- Redis for connection mapping and presence
- End-to-end encryption for privacy
- Fan-out for group messages

---

*WhatsApp handles 100B+ messages daily with this architecture.*
